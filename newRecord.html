<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta charset="UTF-8">
		<link rel="stylesheet" type="text/css" href="style.css">
		<title>WIPI-test</title>
		<!--<script type="text/javascript" src="jscript.js"></script>-->
		
		<style>
		html{
			margin:0 auto;
			padding:auto;
			text-align:center;
		}
		body{
			margin:auto;
			font-family:"微软雅黑";
			text-align:center;
		}
		table{
			margin:auto;
			text-align:left;
		}
		select{
			width:140px;
			height:25px;
			position:relative;
			top:10px;
			left:2px;
		}
		td{
			height:20px !important;
		}
		input[type="text"]{
			width:140px;
			
		}
		.coverInput{
			width:120px !important;
			height:19px;
			position:relative;
			top:-15px;
			left:0px;
		}
		</style>
	</head>
	<body>
		<h2>个人信息</h2>
		<table><tr><td>姓名：</td><td><input type="text" id="name" onchange="chgCheck('name')"></input></td><td>性别：
			<input type="radio" name="sex" id="sexM" value="男"><label for="sexM">男</label>
			<input type="radio" name="sex" id="sexF" value="女"><label for="sexF">女</label>
			</td></tr>
		<!-- 需要做checkbox排斥 -->
		<tr><td>出生日期：</td><td><input id="birthday" type="text" onchange="chgCheck('birthday')" placeholder="2000/01/01"></input></td><td>年龄：<span id="age"></span></td></tr>
		<!-- 年龄自动计算 -->
		<tr><td>监护人身份：</td><td colspan="2">
			<input type="radio" name="guardian" id="G1" value="父"><label for="G1">父</label>
			<input type="radio" name="guardian" id="G2" value="母"><label for="G2">母</label>
			<input type="radio" name="guardian" id="G3" value="祖父母"><label for="G3">祖父母</label>
			<input type="radio" name="guardian" id="G4" value="长托老师"><label for="G4">长托老师</label>
			<input type="radio" name="guardian" id="G5" value="福利院"><label for="G5">福利院</label></td></tr>
		<!-- 不知是否需要做选择排斥 -->
		<tr><td>联系方式：</td><td colspan="2"><input type="text" id="phone" onchange="chgCheck('phone')"></input></td></tr>
		<tr><td>居住地：</td><td colspan="2"><input type="text" style="width:315px;" id="address" onchange="chgCheck('address')"></input></td></tr>
		<tr><td colspan="3" style="text-align:center;"><h3>听力损失相关信息</h3></td></tr>
		<tr><td></td><td style="text-align:center;">左</td><td style="text-align:center;">右</td></tr>
		<tr><td>平均听阈<font size="1%">(dB HL)</font>：</td>
			<td><input id="avgHearing1" type="text" onchange="chgCheck('avgHearing1')"></input></td>
			<td><input id="avgHearing2" type="text" onchange="chgCheck('avgHearing2')"></input></td>
			</td></tr>
		<tr><td>耳聋时间：</td>
			<td><span id="chooseScope"><select id="selectScope1" onchange="chgScope(1)" value="1"><option value="健康">健康</option><option value="先天">先天</option><option value="1-3岁">1-3岁</option><option value="4-6岁">4-6岁</option></select></span>
			<br><input id="inputType1" class="coverInput" type="text" placeholder="选择耳聋时间" onchange="chgCheck('inputType1')"></input>
			</td>
			<td><span id="chooseScope"><select id="selectScope2" onchange="chgScope(2)" value="1"><option value="健康">健康</option><option value="先天">先天</option><option value="1-3岁">1-3岁</option><option value="4-6岁">4-6岁</option></select></span>
			<br><input id="inputType2" class="coverInput" type="text" placeholder="选择耳聋时间" onchange="chgCheck('inputType2')"></input>
			</td></tr>
		<!-- 由于1-3和3-6的3重上了，所以改成了4-6 需要做选择排斥-->
		
		<tr><td>听力损失类型：</td>
			<td><span id="chooseScope"><select id="selectScope3" onchange="chgScope(3)" value="1"><option value="神经性耳聋">神经性耳聋</option><option value="传导性耳聋">传导性耳聋</option><option value="混合性耳聋">混合性耳聋</option><option value="听神经病">听神经病</option><option value="无">无</option></select></span>
			<br><input id="inputType3" class="coverInput" type="text" placeholder="选择听力损失类型" onchange="chgCheck('inputType3')"></input>
			</td>
			<td><span id="chooseScope"><select id="selectScope4" onchange="chgScope(4)"><option value="神经性耳聋">神经性耳聋</option><option value="传导性耳聋">传导性耳聋</option><option value="混合性耳聋">混合性耳聋</option><option value="听神经病">听神经病</option><option value="无">无</option></select></span>
			<br><input id="inputType4" class="coverInput" type="text" placeholder="选择听力损失类型" onchange="chgCheck('inputType4')"></input>
			</td></tr>
		<tr><td>康复装置：</td>
			<td><span id="chooseScope"><select id="selectScope5" onchange="chgScope(5)" value="1"><option value="耳蜗">耳蜗</option><option value="助听器">助听器</option><option value="BAHA">BAHA</option><option value="震动声桥">震动声桥</option><option value="无">无</option></select></span>
			<br><input id="inputType5" class="coverInput" type="text" placeholder="选择康复装置" onchange="chgCheck('inputType5')"></input>
			</td>
			<td><span id="chooseScope"><select id="selectScope6" onchange="chgScope(6)" value="1"><option value="耳蜗">耳蜗</option><option value="助听器">助听器</option><option value="BAHA">BAHA</option><option value="震动声桥">震动声桥</option><option value="无">无</option></select></span>
			<br><input id="inputType6" class="coverInput" type="text" placeholder="选择康复装置" onchange="chgCheck('inputType6')"></input>
			</td></tr>
		<tr><td>第一次使用<br>助听装置的日期：</td>
			<td><input id="useBegin1" type="text" placeholder="2000/01/01" onchange="chgCheck('useBegin1')"></input></td>
			<td><input id="useBegin2" type="text" placeholder="2000/01/01" onchange="chgCheck('useBegin2')"></input></td>
			</td></tr>
		<tr><td>已使用时长：</td>
			<td id="useTime1"></td>
			<td id="useTime2"></td>
			</td></tr>
		</table>
		<br>	
		<INPUT type="submit" name="f" value="确认" onclick="checkFinal()"></TD>

<br>	
	</body>
	
	<script>
	function checkFinal(){
		var flag =0;
		if(document.getElementById("sexM").checked || document.getElementById("sexF").checked ) flag++;
			else alert("您还未选择性别！");
		if(document.getElementById("G1").checked || document.getElementById("G2").checked || document.getElementById("G3").checked || document.getElementById("G4").checked || document.getElementById("G5").checked )  flag++;
			else alert("您还未选择监护人！");
		flag += chgCheck("name");
		flag += chgCheck("birthday");
		flag += chgCheck("phone");
		flag += chgCheck("address");
		flag += chgCheck("inputType1");
		flag += chgCheck("inputType2");
		flag += chgCheck("inputType3");
		flag += chgCheck("inputType4");
		flag += chgCheck("inputType5");
		flag += chgCheck("inputType6");
		flag += chgCheck("useBegin1");
		flag += chgCheck("useBegin2");
		flag += chgCheck("avgHearing1");
		flag += chgCheck("avgHearing2");
		if(flag!=16) alert("您还未填完本表或有输入格式不正确的项目，请核对！");
		else alert("已提交！");
	}
	function chgCheck(type){
	
		if(document.getElementById(type).value==""){
			document.getElementById(type).style.borderColor="red";
			return -1;
		}
		else{
			var value=document.getElementById(type).value;
			if(type=="phone"){
				if(checkPhone(value)==-1) {					
					document.getElementById(type).style.borderColor="red";
					return -1;
				}
				else {
					document.getElementById(type).style.borderColor="";
					return 1;
				}
			}
			else if(type=="birthday"){
				if(getTimeDiff(value,"age")==-1) {					
					document.getElementById(type).style.borderColor="red";
					return -1;
				}
				else {
					document.getElementById(type).style.borderColor="";
					document.getElementById("age").innerHTML= getTimeDiff(value,"age") + "岁";
					return 1;
				}
			}
			else if(type=="useBegin1" || type=="useBegin2"){
				if(getTimeDiff(value,"time")==-1 && value!="未使用") {					
					document.getElementById(type).style.borderColor="red";
					return -1;
				}
				else {
					document.getElementById(type).style.borderColor="";
					if(value=="未使用") document.getElementById("useTime"+type[type.length-1]).innerHTML="未使用";
					else document.getElementById("useTime"+type[type.length-1]).innerHTML= getTimeDiff(value,"time");
					return 1;
				}
			}
			else if(type=="avgHearing1" || type=="avgHearing2"){
				if(parseInt(value)>=-20 && parseInt(value)<=120  ) {					
					document.getElementById(type).style.borderColor="";
					if(parseInt(value)<=25) {document.getElementById(type).style.color="#55dd00";normalLock(type);}
					else if(parseInt(value)<=40) {document.getElementById(type).style.color="#aabb00";cleanInput();}
					else if(parseInt(value)<=60) {document.getElementById(type).style.color="#ff9900";cleanInput();}
					else if(parseInt(value)<=80) {document.getElementById(type).style.color="#ff5500";cleanInput();}
					else {document.getElementById(type).style.color="#dd1100";cleanInput();}
					return 1;
				}
				else {
					document.getElementById(type).style.borderColor="red";
					return -1;
				}
			}
			else{
				document.getElementById(type).style.borderColor="";
				return 1;
			}
		}
	}
	function cleanInput(){
		for(var i=1;i<=6;i++){
			document.getElementById("inputType"+i).value="";
		}
		document.getElementById("useBegin1").value="";
		document.getElementById("useTime1").innerHTML="";
		document.getElementById("useBegin2").value="";
		document.getElementById("useTime2").innerHTML="";
	}
	function normalLock(type){
		document.getElementById("inputType"+type[type.length-1]).value="健康";
		document.getElementById("inputType"+(parseInt(type[type.length-1])+2)).value="无";
		document.getElementById("inputType"+(parseInt(type[type.length-1])+4)).value="无";
		noDevice(parseInt(type[type.length-1])+4);
	}
	function noDevice(type){
		document.getElementById("useBegin"+(parseInt(type)-4)).value="无";
		document.getElementById("useTime"+(parseInt(type)-4)).innerHTML="未使用";
	}
	function chgScope(n){
		document.getElementById("inputType"+n).value=document.getElementById("selectScope"+n).value;
		if(n==5 ||n==6){
			noDevice(n);
		}
	}
	function getTimeDiff(strBirthday,type){ 
		if(!(/^([0-9]{3}[1-9]|[0-9]{2}[1-9][0-9]{1}|[0-9]{1}[1-9][0-9]{2}|[1-9][0-9]{3})\/(((0[13578]|1[02])\/(0[1-9]|[12][0-9]|3[01]))|((0[469]|11)\/(0[1-9]|[12][0-9]|30))|(02\/(0[1-9]|[1][0-9]|2[0-8])))$/.test(strBirthday))) return -1;
		var returnAge;
		var returnMonth
		var strBirthdayArr=strBirthday.split("/");
		var birthYear = strBirthdayArr[0];
		var birthMonth = strBirthdayArr[1];
		var birthDay = strBirthdayArr[2];
		
		d = new Date();
		var nowYear = d.getFullYear();
		var nowMonth = d.getMonth() + 1;
		var nowDay = d.getDate();
		var monthDiff = 0;
		var dayDiff = 0;
		
		if(nowYear == birthYear) returnAge = 0;//同年 则为0岁
		else{
			var ageDiff = nowYear - birthYear ; //年之差
			if(ageDiff > 0){
				dayDiff = nowDay - birthDay;
				if(nowMonth == birthMonth) {
					if(dayDiff < 0) returnAge = ageDiff - 1;
					else returnAge = ageDiff;
				}
				else{
					monthDiff = nowMonth - birthMonth;//月之差
					if(monthDiff < 0) returnAge = ageDiff - 1;
					else returnAge = ageDiff;
				}
			}
			else returnAge = -1;//返回-1 表示出生日期输入错误 晚于今天
		}
		if(type=="age"){
			return returnAge;//返回周岁年龄
		}
		else if(type=="time"){
			if(monthDiff<0){
				monthDiff+=12;
				if(dayDiff<0) monthDiff--;
			}
			return (returnAge+"Y"+monthDiff+"M");
		}
	}
	function checkTime(value){
		var reg = /^[1-9]\d{3}\/(0[1-9]|1[0-2])\/(0[1-9]|[1-2][0-9]|3[0-1])$/;
		var regExp = new RegExp(reg);
		if(!regExp.test(value)) return -1;	
	}

	function checkPhone(phone){ 
		//var phone = document.getElementById('phone').value;
		if(!(/^1[34578]\d{9}$/.test(phone))) return -1;	
		return 1;
	}
	</script>
	
</html>